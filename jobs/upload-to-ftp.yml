########################################################################
# Job to upload a build artifact to FTP
########################################################################

parameters:
  vmImage: 'Ubuntu 16.04'
  name: 'Upload_to_FTP'
  ftpUrl: 'ftp://ftp.askmonty.org'
  ftpDirectory: '/private/azure'
  ftpUser: 'anonymous'
  ftpPassword: 'foo'
  artifactName: 'build'
  dependencies: []

jobs:

#-----------------------------------------------------------------------
# Publish a build artifact to FTP

- job: ${{ parameters.name }}
  pool:
    vmImage: ${{ parameters.vmImage }}

  dependsOn: ${{ parameters.dependencies }}

  steps:

  # Get the artifact from build artifacts
  - task: DownloadBuildArtifacts@0
    inputs:
      artifactName: ${{ parameters.artifactName }}
      downloadPath: $(Build.ArtifactStagingDirectory)

  # Upload to FTP
  - task: FtpUpload@1
    inputs:
      credentialsOption: 'inputs'
      serverUrl: '${{ parameters.ftpUrl }}'
      username: '${{ parameters.ftpUser }}'
      password: '${{ parameters.ftpPassword }}'
      rootDirectory: '$(Build.ArtifactStagingDirectory)/build'
      remoteDirectory: '${{ parameters.ftpDirectory }}'
    displayName: 'Upload ${{ parameters.artifactName }} to FTP'
