########################################################################
# Run single RQG test and collect test result information
########################################################################

parameters:
  condition: succeeded()
  name: 'trial'

steps:
  - script: |
      mkdir -p $ENV_LOGDIR
      set -xo pipefail
      cd $ENV_RQG_HOME
      perl ./runall-new.pl \
        --basedir=$ENV_BASEDIR \
        --vardir=$ENV_LOGDIR/vardir \
        $ENV_RQG_OPTIONS \
        2>&1 | tee $ENV_LOGDIR/trial.log
    name: ${{ parameters.name }}
    displayName: Run RQG test ${{ parameters.name }}
    condition: ${{ parameters.condition }}

  - template: rqg-test-result.yml
